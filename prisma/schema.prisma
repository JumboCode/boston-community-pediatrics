generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String          @id @default(cuid())
  clerkId       String          @default("placeholder")
  firstName     String
  lastName      String
  emailAddress  String          @unique
  phoneNumber   String
  dateOfBirth   DateTime?
  streetAddress String?
  city          String?
  state         String?
  country       String?
  zipCode       String?
  hoursWorked   Int             @default(0)
  createdAt     DateTime        @default(now()) @map("created_at")
  updatedAt     DateTime        @updatedAt @map("updated_at")
  role          UserRole
  profileImage  String?
  speaksSpanish Boolean?
  signups       EventSignup[]
  waitlists     EventWaitlist[]

  @@index([clerkId])
  @@map("users")
}

model Event {
  id            String          @id @default(cuid())
  name          String
  description   String
  date          DateTime[]
  startTime     DateTime
  endTime       DateTime
  city          String          @default("")
  state         String          @default("")
  country       String          @default("")
  zipCode       String          @default("")
  lat           Float?
  lng           Float?
  addressLine1  String          @default("")
  addressLine2  String?
  images        String[]
  pinned        Boolean         @default(false)
  imagesDeleted Boolean         @default(false)
  positions     EventPosition[]
  signups       EventSignup[]
}

model EventSignup {
  id         String        @id @default(cuid())
  userId     String?
  eventId    String
  positionId String
  hasGuests  Boolean       @default(false)
  date       DateTime?
  time       DateTime?
  notes      String?
  event      Event         @relation(fields: [eventId], references: [id], onDelete: Cascade)
  position   EventPosition @relation(fields: [positionId], references: [id], onDelete: Cascade)
  user       User?         @relation(fields: [userId], references: [id], onDelete: Cascade)
  guests     Guest[]
}

model EventPosition {
  id           String          @id @default(cuid())
  position     String
  eventId      String
  date         DateTime
  startTime    DateTime
  endTime      DateTime
  description  String
  filledSlots  Int
  totalSlots   Int
  addressLine1 String          @default("")
  addressLine2 String?
  city         String          @default("")
  country      String          @default("")
  state        String          @default("")
  zipCode      String          @default("")
  event        Event           @relation(fields: [eventId], references: [id], onDelete: Cascade)
  signups      EventSignup[]
  waitlists    EventWaitlist[]
}

model Guest {
  id            String      @id @default(cuid())
  positionId    String
  firstName     String
  lastName      String
  emailAddress  String?
  relation      String?
  phoneNumber   String?
  signupId      String
  dateOfBirth   String?
  comments      String?
  speaksSpanish Boolean?
  signup        EventSignup @relation(fields: [signupId], references: [id], onDelete: Cascade)
}

model EventWaitlist {
  id         String          @id @default(cuid())
  userId     String?
  positionId String
  isGuest    Boolean         @default(false)
  createdAt  DateTime?       @db.Timestamp(6)
  position   EventPosition   @relation(fields: [positionId], references: [id], onDelete: Cascade)
  user       User?           @relation(fields: [userId], references: [id], onDelete: Cascade)
  guests     WaitlistGuest[]
}

model WaitlistGuest {
  id            String        @id @default(cuid())
  firstName     String
  lastName      String
  email         String?
  relation      String?
  waitlistId    String
  dateOfBirth   String?
  comments      String?
  speaksSpanish Boolean?
  waitlist      EventWaitlist @relation(fields: [waitlistId], references: [id], onDelete: Cascade)
}

enum UserRole {
  VOLUNTEER
  ADMIN
}
